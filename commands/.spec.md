---
description: Manage feature specs with smart context detection - auto-syncs to matching agent
---

# Spec Management Command

**Arguments:** $ARGUMENTS

## Step 1: Detect Context

If no feature specified, auto-detect from environment:

```bash
# Get current directory and branch
pwd
git branch --show-current 2>/dev/null || echo "not a git repo"
```

**Extract feature from:**
- Directory name: `myproject-client-123-feature` → `mail`
- Branch name: `feature/proj-123-feature` → `mail`
- Pattern: look for `auth`, `billing`, `notifications`, `settings`, etc.

**Detect app from:**
- Directory contains `api` → Laravel backend
- Directory contains `client` → Next.js frontend

## Step 2: Map to Files

| Feature | Spec File | Agent File |
|---------|-----------|------------|
| mail | `~/.claude/specs/mail.md` | `~/.claude/agents/proj-mail.md` |
| audit | `~/.claude/specs/audit.md` | `~/.claude/agents/proj-audit.md` |
| permissions | `~/.claude/specs/permissions.md` | `~/.claude/agents/proj-permissions.md` |

## Step 3: Execute Action

### No args or just feature name → View
```
/spec
/spec mail
```
Display the spec content. If no feature specified and can't auto-detect, list all specs.

### `status [text]` → Update Status
```
/spec status "Completed Maily integration"
/spec mail status "Completed Maily integration"
```
1. Read spec file
2. Update the `## Current Status` table
3. Sync relevant status info to agent if needed

### `note [text]` → Add Note
```
/spec note "Using SendGrid for delivery"
/spec mail note "Using SendGrid for delivery"
```
1. Read spec file
2. Append to `## Notes` section with timestamp: `- [YYYY-MM-DD] note text`
3. If note mentions code paths/files, sync to agent's search paths

### `edit` → Interactive Edit
```
/spec edit
/spec mail edit
```
Show spec, ask which section to update, make changes, sync to agent.

### `paths [paths...]` → Update Code Paths
```
/spec paths app/Services/MailService.php components/mail/
/spec mail paths app/Services/MailService.php
```
1. Add paths to spec's relevant section
2. **Sync to agent's search paths**

### `create [feature]` → New Spec + Agent
```
/spec create billing
```
1. Create spec from template at `~/.claude/specs/{feature}.md`
2. Create matching agent at `~/.claude/agents/proj-{feature}.md`

## Step 4: Sync to Agent

After ANY spec update, check if agent needs syncing:

**Always sync these from spec → agent:**
- Feature scope/overview → agent's "Feature Scope" section
- Code paths mentioned → agent's search paths
- Key components → agent's grep patterns
- Data models → agent knows what to search for

**Sync logic:**
1. Read the updated spec
2. Extract: code paths, components, models, endpoints
3. Read the matching agent file
4. Update agent's search paths and patterns if spec has new info
5. Write updated agent

**Example sync:**
Spec mentions: `app/Services/NewMailService.php`
Agent gets: new path added to "search these paths" section

## Output Format

```
Detected: mail feature (from branch feature/proj-123-feature)
App: client (Next.js)

Updated: ~/.claude/specs/mail.md
- Added status: "Completed Maily integration"

Synced: ~/.claude/agents/proj-mail.md
- No changes needed (paths already covered)

Done.
```

## Template for New Specs

When creating new spec, use this structure:

```markdown
# Project {Feature} Feature Spec

## Overview
[Brief description]

## Requirements
- [ ] Requirement 1

## Business Rules
- Rule 1

## Data Model
\`\`\`
Model
- field
\`\`\`

## API Endpoints
| Method | Endpoint | Description |
|--------|----------|-------------|

## UI Components
- Component 1

## Current Status
| Task | Status | Notes |
|------|--------|-------|

## Notes
-
```

## Template for New Agents

When creating new agent, use this structure:

```markdown
---
name: proj-{feature}
description: Use this agent to get context on the Project {Feature} feature. Use when working on {feature} functionality.
model: sonnet
color: purple
---

You are the Project {Feature} Feature Context Agent for the Project project:
- **myproject-api**: Laravel 12 backend
- **my-client**: Next.js 14 frontend

## Your Purpose
Provide context on the {Feature} feature when developers jump back to this work.

## Feature Scope
[From spec overview]

## Step 1: Read the Spec
\`\`\`bash
cat ~/.claude/specs/{feature}.md
\`\`\`

## Step 2: Search Codebase
**API (Laravel):**
- [paths from spec]

**Client (Next.js):**
- [paths from spec]

## Step 3: Return Summary
[Standard summary format]
```
